(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[143],{vWAY:function(e,n,t){"use strict";t.r(n);var a=t("q1tI"),c=t.n(a),r=t("dEAq"),l=t("H1Ra"),o=c.a.memo((e=>{e.demos;return c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"markdown"},c.a.createElement("h1",{id:"webpack\u7684\u70ed\u66f4\u65b0\u662f\u5982\u4f55\u505a\u5230\u7684\u8bf4\u660e\u5176\u539f\u7406"},c.a.createElement(r["AnchorLink"],{to:"#webpack\u7684\u70ed\u66f4\u65b0\u662f\u5982\u4f55\u505a\u5230\u7684\u8bf4\u660e\u5176\u539f\u7406","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"webpack\u7684\u70ed\u66f4\u65b0\u662f\u5982\u4f55\u505a\u5230\u7684?\u8bf4\u660e\u5176\u539f\u7406?"),c.a.createElement("h2",{id:"1-\u4ec0\u4e48\u662fhmr"},c.a.createElement(r["AnchorLink"],{to:"#1-\u4ec0\u4e48\u662fhmr","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"1. \u4ec0\u4e48\u662fHMR"),c.a.createElement("ul",null,c.a.createElement("li",null,"Hot Module Replacement\u662f\u6307\u5f53\u4f60\u5bf9\u4ee3\u7801\u4fee\u6539\u5e76\u4fdd\u5b58\u540e\uff0cwebpack\u5c06\u4f1a\u5bf9\u4ee3\u7801\u8fdb\u884c\u5f97\u65b0\u6253\u5305\uff0c\u5e76\u5c06\u65b0\u7684\u6a21\u5757\u53d1\u9001\u5230\u6d4f\u89c8\u5668\u7aef\uff0c\u6d4f\u89c8\u5668\u7528\u65b0\u7684\u6a21\u5757\u66ff\u6362\u6389\u65e7\u7684\u6a21\u5757\uff0c\u4ee5\u5b9e\u73b0\u5728\u4e0d\u5237\u65b0\u6d4f\u89c8\u5668\u7684\u524d\u63d0\u4e0b\u66f4\u65b0\u9875\u9762\u3002"),c.a.createElement("li",null,"\u76f8\u5bf9\u4e8e",c.a.createElement("code",null,"live reload"),"\u5237\u65b0\u9875\u9762\u7684\u65b9\u6848\uff0cHMR\u7684\u4f18\u70b9\u5728\u4e8e\u53ef\u4ee5\u4fdd\u5b58\u5e94\u7528\u7684\u72b6\u6001,\u63d0\u9ad8\u4e86\u5f00\u53d1\u6548\u7387")),c.a.createElement("h2",{id:"2-\u642d\u5efahmr\u9879\u76ee"},c.a.createElement(r["AnchorLink"],{to:"#2-\u642d\u5efahmr\u9879\u76ee","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"2. \u642d\u5efaHMR\u9879\u76ee"),c.a.createElement("h3",{id:"21-\u5b89\u88c5\u4f9d\u8d56\u7684\u6a21\u5757"},c.a.createElement(r["AnchorLink"],{to:"#21-\u5b89\u88c5\u4f9d\u8d56\u7684\u6a21\u5757","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"2.1 \u5b89\u88c5\u4f9d\u8d56\u7684\u6a21\u5757"),c.a.createElement(l["a"],{code:"cnpm i webpack webpack-cli webpack-dev-server mime html-webpack-plugin express socket.io events -S",lang:"js"}),c.a.createElement("h3",{id:"22-packagejson"},c.a.createElement(r["AnchorLink"],{to:"#22-packagejson","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"2.2 package.json"),c.a.createElement("p",null,"package.json"),c.a.createElement(l["a"],{code:'{\n  "name": "zhufeng_hmr",\n  "version": "1.0.0",\n  "description": "",\n  "main": "index.js",\n  "scripts": {\n    "build": "webpack",\n    "dev": "webpack-dev-server"\n  },\n  "keywords": [],\n  "author": "",\n  "license": "ISC",\n  "dependencies": {\n    "webpack": "4.39.1",\n    "webpack-cli": "3.3.6",\n    "webpack-dev-server": "3.7.2"\n  }\n}',lang:"json"}),c.a.createElement("h3",{id:"23-webpackconfigjs"},c.a.createElement(r["AnchorLink"],{to:"#23-webpackconfigjs","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"2.3 webpack.config.js"),c.a.createElement("p",null,"webpack.config.js"),c.a.createElement(l["a"],{code:"const path = require('path');\nconst webpack = require('webpack');\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\nmodule.exports = {\n    mode:'development',\n    entry: './src/index.js',\n    output: {\n        filename: 'main.js',\n        path: path.join(__dirname, 'dist')\n    },\n    devServer: {\n        contentBase:path.join(__dirname, 'dist')\n    },\n    plugins:[\n        new HtmlWebpackPlugin({\n            template:'./src/index.html',\n            filename:'index.html'\n        })\n    ]\n}",lang:"js"}),c.a.createElement("h3",{id:"24-srcindexjs"},c.a.createElement(r["AnchorLink"],{to:"#24-srcindexjs","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"2.4 src\\index.js"),c.a.createElement("p",null,"src\\index.js"),c.a.createElement(l["a"],{code:"let root = document.getElementById('root');\nfunction render(){\n   let title = require('./title').default;\n   root.innerHTML= title;\n}\nrender();",lang:"js"}),c.a.createElement("h3",{id:"25-srctitlejs"},c.a.createElement(r["AnchorLink"],{to:"#25-srctitlejs","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"2.5 src\\title.js"),c.a.createElement("p",null,"src\\title.js"),c.a.createElement(l["a"],{code:"export default 'hello';",lang:"js"}),c.a.createElement("h3",{id:"26-srcindexhtml"},c.a.createElement(r["AnchorLink"],{to:"#26-srcindexhtml","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"2.6 src\\index.html"),c.a.createElement("p",null,"src\\index.html"),c.a.createElement(l["a"],{code:'<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <meta http-equiv="X-UA-Compatible" content="ie=edge">\n    <title>webpack\u70ed\u66f4\u65b0</title>\n</head>\n<body>\n    <div id="root"></div>\n</body>\n</html>',lang:"html"}),c.a.createElement("h2",{id:"3\u6d41\u7a0b\u56fe"},c.a.createElement(r["AnchorLink"],{to:"#3\u6d41\u7a0b\u56fe","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"3.\u6d41\u7a0b\u56fe"),c.a.createElement("p",null,c.a.createElement("img",{src:"http://img.zhufengpeixun.cn/webpackhmr.png",alt:"webpackhmr.png"})),c.a.createElement("h2",{id:"4\u5b9e\u73b0"},c.a.createElement(r["AnchorLink"],{to:"#4\u5b9e\u73b0","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"4.\u5b9e\u73b0"),c.a.createElement("h3",{id:"41-webpackconfigjs"},c.a.createElement(r["AnchorLink"],{to:"#41-webpackconfigjs","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"4.1 webpack.config.js"),c.a.createElement(l["a"],{code:'const path = require("path");\nconst webpack = require("webpack");\nconst HtmlWebpackPlugin = require("html-webpack-plugin");\nmodule.exports = {\n  mode: "development",\n  entry: "./src/index.js",\n  output: {\n    filename: "main.js",\n    path: path.join(__dirname, "dist"),\n  },\n  devServer: {\n    hot: true,\n    contentBase: path.join(__dirname, "dist"),\n  },\n  plugins: [\n    new HtmlWebpackPlugin({\n      template: "./src/index.html",\n      filename: "index.html",\n    }),\n    new webpack.HotModuleReplacementPlugin()\n  ]\n};',lang:"js"}),c.a.createElement("h3",{id:"42-indexjs"},c.a.createElement(r["AnchorLink"],{to:"#42-indexjs","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"4.2 index.js"),c.a.createElement("p",null,"src\\index.js"),c.a.createElement(l["a"],{code:"import '../webpackHotDevClient';\nlet root = document.getElementById(\"root\");\nfunction render() {\n  let title = require(\"./title\");\n  root.innerHTML = title;\n}\nrender();\n\n\nif(module.hot){\n  module.hot.accept(['./title'],()=>{\n      render();\n  });\n}",lang:"js"}),c.a.createElement("h3",{id:"43-srctitlejs"},c.a.createElement(r["AnchorLink"],{to:"#43-srctitlejs","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"4.3 src\\title.js"),c.a.createElement("p",null,"src\\title.js"),c.a.createElement(l["a"],{code:"module.exports = 'title7';",lang:"js"}),c.a.createElement("h3",{id:"44-srcindexhtml"},c.a.createElement(r["AnchorLink"],{to:"#44-srcindexhtml","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"4.4 src\\index.html"),c.a.createElement("p",null,"src\\index.html"),c.a.createElement(l["a"],{code:'<!DOCTYPE html>\n<html lang="en">\n\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <meta http-equiv="X-UA-Compatible" content="ie=edge">\n    <title>webpack\u70ed\u66f4\u65b0</title>\n</head>\n\n<body>\n    <div id="root"></div>\n    <script src="/socket.io/socket.io.js"><\/script>\n</body>\n\n</html>',lang:"html"}),c.a.createElement("h3",{id:"45-webpack-dev-serverjs"},c.a.createElement(r["AnchorLink"],{to:"#45-webpack-dev-serverjs","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"4.5 webpack-dev-server.js"),c.a.createElement("p",null,"webpack-dev-server.js"),c.a.createElement(l["a"],{code:'const path = require("path");\nconst fs = require("fs");\nconst express = require("express");\nconst mime = require("mime");\nconst webpack = require("webpack");\nlet config = require("./webpack.config");\nlet compiler = webpack(config);\n//1. \u521b\u5efawebpack\u5b9e\u4f8b\n//2. \u542f\u52a8webpack-dev-server\u670d\u52a1\u5668\nclass Server {\n  constructor(compiler) {\n    //4. \u6dfb\u52a0webpack\u7684`done`\u4e8b\u4ef6\u56de\u8c03\uff0c\u5728\u7f16\u8bd1\u5b8c\u6210\u540e\u4f1a\u5411\u6d4f\u89c8\u5668\u53d1\u9001\u6d88\u606f\n    let lastHash;\n    let sockets = [];\n    compiler.hooks.done.tap("webpack-dev-server", (stats) => {\n      lastHash = stats.hash;\n      sockets.forEach((socket) => {\n        socket.emit("hash", stats.hash);\n        socket.emit("ok");\n      });\n    });\n    let app = new express();\n    compiler.watch({}, (err) => {\n      console.log("\u7f16\u8bd1\u6210\u529f");\n    });\n\n    //3. \u6dfb\u52a0webpack-dev-middleware\u4e2d\u95f4\u4ef6\n    const webpackDevMiddleware = (req, res, next) => {\n      if (req.url === "/favicon.ico") {\n        return res.sendStatus(404);\n      }\n      let filename = path.join(config.output.path, req.url.slice(1));\n      try {\n        let stats = fs.statSync(filename);\n        if (stats.isFile()) {\n          let content = fs.readFileSync(filename);\n          res.header("Content-Type", mime.getType(filename));\n          res.send(content);\n        } else {\n          next();\n        }\n      } catch (error) {\n          return res.sendStatus(404);\n      }\n    };\n    app.use(webpackDevMiddleware);\n    this.server = require("http").createServer(app);\n    //4. \u4f7f\u7528sockjs\u5728\u6d4f\u89c8\u5668\u7aef\u548c\u670d\u52a1\u7aef\u4e4b\u95f4\u5efa\u7acb\u4e00\u4e2a websocket \u957f\u8fde\u63a5\n    //\u5c06 webpack \u7f16\u8bd1\u6253\u5305\u7684\u5404\u4e2a\u9636\u6bb5\u7684\u72b6\u6001\u4fe1\u606f\u544a\u77e5\u6d4f\u89c8\u5668\u7aef,\u6d4f\u89c8\u5668\u7aef\u6839\u636e\u8fd9\u4e9b`socket`\u6d88\u606f\u8fdb\u884c\u4e0d\u540c\u7684\u64cd\u4f5c\n    //\u5f53\u7136\u670d\u52a1\u7aef\u4f20\u9012\u7684\u6700\u4e3b\u8981\u4fe1\u606f\u8fd8\u662f\u65b0\u6a21\u5757\u7684`hash`\u503c\uff0c\u540e\u9762\u7684\u6b65\u9aa4\u6839\u636e\u8fd9\u4e00`hash`\u503c\u6765\u8fdb\u884c\u6a21\u5757\u70ed\u66ff\u6362\n    let io = require("socket.io")(this.server);\n    io.on("connection", (socket) => {\n      sockets.push(socket);\n      if (lastHash) {\n        //5.\u53d1\u9001hash\u503c\n        socket.emit("hash", lastHash);\n        socket.emit("ok");\n      }\n    });\n  }\n  //9. \u521b\u5efahttp\u670d\u52a1\u5668\u5e76\u542f\u52a8\u670d\u52a1\n  listen(port) {\n    this.server.listen(port, () => {\n      console.log(port + "\u670d\u52a1\u542f\u52a8\u6210\u529f!");\n    });\n  }\n}\n//3. \u521b\u5efaServer\u670d\u52a1\u5668\nlet server = new Server(compiler);\nserver.listen(8080);',lang:"js"}),c.a.createElement("h3",{id:"46-webpackhotdevclientjs"},c.a.createElement(r["AnchorLink"],{to:"#46-webpackhotdevclientjs","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"4.6 webpackHotDevClient.js"),c.a.createElement("p",null,"webpackHotDevClient.js"),c.a.createElement(l["a"],{code:'let socket = io("/");\nlet currentHash;\nlet hotCurrentHash;\nconst onConnected = () => {\n  console.log("\u5ba2\u6237\u7aef\u5df2\u7ecf\u8fde\u63a5");\n  //6. \u5ba2\u6237\u7aef\u4f1a\u76d1\u542c\u5230\u6b64hash\u6d88\u606f\n  socket.on("hash", (hash) => {\n    currentHash = hash;\n  });\n  //7. \u5ba2\u6237\u7aef\u6536\u5230`ok`\u7684\u6d88\u606f\n  socket.on("ok", () => {\n    hotCheck();\n  });\n  socket.on("disconnect", () => {\n     hotCurrentHash = currentHash = null;\n  });\n};\n//8.\u6267\u884chotCheck\u65b9\u6cd5\u8fdb\u884c\u66f4\u65b0\nfunction hotCheck() {\n  if (!hotCurrentHash || hotCurrentHash === currentHash) {\n    return (hotCurrentHash = currentHash);\n  }\n  //9.\u5411 server \u7aef\u53d1\u9001 Ajax \u8bf7\u6c42\uff0c\u670d\u52a1\u7aef\u8fd4\u56de\u4e00\u4e2ahot-update.json\u6587\u4ef6\uff0c\u8be5\u6587\u4ef6\u5305\u542b\u4e86\u6240\u6709\u8981\u66f4\u65b0\u7684\u6a21\u5757\u7684 `hash` \u503c\u548cchunk\u540d\n  hotDownloadManifest().then((update) => {\n    let chunkIds = Object.keys(update.c);\n    chunkIds.forEach((chunkId) => {\n      //10. \u901a\u8fc7JSONP\u8bf7\u6c42\u83b7\u53d6\u5230\u6700\u65b0\u7684\u6a21\u5757\u4ee3\u7801\n      hotDownloadUpdateChunk(chunkId);\n    });\n  });\n}\n\nfunction hotDownloadUpdateChunk(chunkId) {\n  var script = document.createElement("script");\n  script.charset = "utf-8";\n  script.src = "/" + chunkId + "." + hotCurrentHash+ ".hot-update.js";\n  document.head.appendChild(script);\n}\nfunction hotDownloadManifest() {\n  var url = "/" + hotCurrentHash + ".hot-update.json";\n  return fetch(url).then(res => res.json()).catch(error=>{console.log(error);});\n}\n//11. \u8865\u4e01JS\u53d6\u56de\u6765\u540e\u4f1a\u8c03\u7528`webpackHotUpdate`\u65b9\u6cd5\nwindow.webpackHotUpdate = (chunkId, moreModules) => {\n  for (let moduleId in moreModules) {\n    let oldModule = __webpack_require__.c[moduleId];//\u83b7\u53d6\u8001\u6a21\u5757\n    let { parents, children } = oldModule;//\u7236\u4eb2\u4eec \u513f\u5b50\u4eec\n    var module = (__webpack_require__.c[moduleId] = {\n      i: moduleId,\n      exports: {},\n      parents,\n      children,\n      hot: window.hotCreateModule(),\n    });\n    moreModules[moduleId].call(\n      module.exports,\n      module,\n      module.exports,\n      __webpack_require__\n    );\n    parents.forEach((parent) => {\n      let parentModule = __webpack_require__.c[parent];\n      parentModule.hot &&\n        parentModule.hot._acceptedDependencies[moduleId] &&\n        parentModule.hot._acceptedDependencies[moduleId]();\n    });\n    hotCurrentHash = currentHash;\n  }\n};\nsocket.on("connect", onConnected);\nwindow.hotCreateModule = () => {\n  var hot = {\n    _acceptedDependencies: {}, //\u63a5\u6536\u7684\u4f9d\u8d56\n    _acceptedDependencies: function (dep, callback) {\n      for (var i = 0; i < dep.length; i++) {\n        hot._acceptedDependencies[dep[i]] = callback;\n      }\n    },\n  };\n  return hot;\n}',lang:"js"})))}));n["default"]=e=>{var n=c.a.useContext(r["context"]),t=n.demos;return c.a.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&r["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),c.a.createElement(o,{demos:t})}}}]);